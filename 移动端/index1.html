<html>
    <head>
    <title>ActiveMQ</title>
    <meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />

<link href='/styles/github.css' rel='stylesheet' type='text/css' />
<script src='/javascripts/highlight.pack.js' type='text/javascript'></script>

<link href='/images/fav.png' rel='shortcut icon'>
<link href='/stylesheets/style.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/syntax.css' rel='stylesheet' type='text/css' />
<link href='/stylesheets/responsive.css' rel='stylesheet' type='text/css' />
<link href="/stylesheets/nprogress.css" rel='stylesheet' type='text/css' />
<link href="/stylesheets/duoshuo.css" rel='stylesheet' type='text/css' />

<link href="/feed.xml" rel="alternate" type="application/rss+xml">

<script src='/javascripts/jquery.js' type='text/javascript'></script>
<script src='/javascripts/jquery.particleground.min.js' type='text/javascript'></script>
<script src='/javascripts/nprogress.js' type='text/javascript'></script>
<script src='/javascripts/theater.js' type='text/javascript'></script>

<script src='/javascripts/app.js' type='text/javascript'></script>
<script>
    hljs.initHighlightingOnLoad();
    var duoshuoQuery = {short_name:"kbasha"};

</script>

    </head>
    <body>

        <header>

<div id="blog-desc">
    If you want do, then do.
</div>

</header>

<div id="main">
    <div id="left">
    <a id="head-pic" class="go-back-home" href="/"><img src="../images/kbasha.jpg" alt="Home" width="100" height="100"></a>
    <p>克巴沙</p>
        <ul id="titles" class="titles">
            
        </ul>
    </div>

    <div id="right">
    <a id="scaner-pic" class="go-back-home" href="/"><img src="../images/kbasha_id.jpg" alt="Home" width="172" height="172"></a>
    <p>关注公众号</p>
        
    </div>

        <div id='container'>
            
            <div class="block nav">
    <ul>
    
        <li>
            <span class="line line-top"></span>
            <span class="line line-right"></span>
            <span class="line line-bottom"></span>
            <span class="line line-left"></span>
            <a target="_top" href="/about.html">About</a>
        </li>
    
        <li>
            <span class="line line-top"></span>
            <span class="line line-right"></span>
            <span class="line line-bottom"></span>
            <span class="line line-left"></span>
            <a target="_top" href="/">Blog</a>
        </li>
        <li>
            <span class="line line-top"></span>
            <span class="line line-right"></span>
            <span class="line line-bottom"></span>
            <span class="line line-left"></span>
            <a target="_blank" href="https://github.com/kebasha">GitHub</a>
        </li>
        
    </ul>

</div>


            <section class="paging">
  
    <div class="left">
      <a href="#">
        ‹
      </a>
    </div>
  
    <div class="right">
      <a href="index2.html">
        ›
      </a>
    </div>
  
</section>


<div class="content">
    <section class='post'>
        <h1>
            MQ(Message Queue)
            <div class='date'>2016-03-15 23:21:07</div>
        </h1>
<hr>
<p><strong><code>消息传递模型</code></strong></p>
<img src="index1_01.png"/>

<hr>

<p><strong><code>RabbitMQ</code></strong></p>
<blockquote>
<p style="text-indent:2em;">是使用Erlang编写的一个开源的消息队列，本身支持很多的协议：AMQP，XMPP, SMTP, STOMP，也正是如此，使的它变的非常重量级，更适合于企业级的开发。同时实现了一个经纪人(Broker)构架，这意味着消息在发送给客户端时先在中心队列排队。对路由(Routing)，负载均衡(Load balance)或者数据持久化都有很好的支持。</p>
</blockquote>
<hr>

<p><strong><code>Redis</code></strong></p>
<blockquote>
<p style="text-indent:2em;">是一个Key-Value的NoSQL数据库，开发维护很活跃，虽然它是一个Key-Value数据库存储系统，但它本身支持MQ功能，所以完全可以当做一个轻量级的队列服务来使用。对于RabbitMQ和Redis的入队和出队操作，各执行100万次，每10万次记录一次执行时间。测试数据分为128Bytes、512Bytes、1K和10K四个不同大小的数据。实验表明：入队时，当数据比较小时Redis的性能要高于RabbitMQ，而如果数据大小超过了10K，Redis则慢的无法忍受；出队时，无论数据大小，Redis都表现出非常好的性能，而RabbitMQ的出队性能则远低于Redis</p>
</blockquote>
<hr>

<p><strong><code>ZeroMQ</code></strong></p>
<blockquote>
<p style="text-indent:2em;">号称最快的消息队列系统，尤其针对大吞吐量的需求场景。ZMQ能够实现RabbitMQ不擅长的高级/复杂的队列，但是开发人员需要自己组合多种技术框架，技术上的复杂度是对这MQ能够应用成功的挑战。ZeroMQ具有一个独特的非中间件的模式，你不需要安装和运行一个消息服务器或中间件，因为你的应用程序将扮演了这个服务角色。你只需要简单的引用ZeroMQ程序库，可以使用NuGet安装，然后你就可以愉快的在应用程序之间发送消息了。但是ZeroMQ仅提供非持久性的队列，也就是说如果down机，数据将会丢失。其中，Twitter的Storm中使用ZeroMQ作为数据流的传输。</p>
</blockquote>
<hr>

<p><strong><code>ActiveMQ</code></strong></p>
<blockquote>
<p style="text-indent:2em;">是Apache下的一个子项目。 类似于ZeroMQ，它能够以代理人和点对点的技术实现队列。同时类似于RabbitMQ，它少量代码就可以高效地实现高级应用场景。RabbitMQ、ZeroMQ、ActiveMQ均支持常用的多种语言客户端 C++、Java、.Net,、Python、 Php、 Ruby等。</p>
</blockquote>
<hr>

<p><strong><code>Jafka/Kafka</code></strong></p>
<blockquote>
<p style="text-indent:2em;">Kafka是Apache下的一个子项目，是一个高性能跨语言分布式Publish/Subscribe消息队列系统，而Jafka是在Kafka之上孵化而来的，即Kafka的一个升级版。具有以下特性：快速持久化，可以在O(1)的系统开销下进行消息持久化；高吞吐，在一台普通的服务器上既可以达到10W/s的吞吐速率；完全的分布式系统，Broker、Producer、Consumer都原生自动支持分布式，自动实现复杂均衡；支持Hadoop数据并行加载，对于像Hadoop的一样的日志数据和离线分析系统，但又要求实时处理的限制，这是一个可行的解决方案。Kafka通过Hadoop的并行加载机制来统一了在线和离线的消息处理，这一点也是本课题所研究系统所看重的。Apache Kafka相对于ActiveMQ是一个非常轻量级的消息系统，除了性能非常好之外，还是一个工作良好的分布式系统。</p>
</blockquote>
<hr>

<p><strong><code>消息的组成</code></strong></p>
<ul>
<li>1、头(head)</li>
<li>2、属性(property)</li>
<li>3、主体(body)</li>
</ul>
<hr>

<p><strong><code>ActiveMQ Queue与Topic</code></strong></p>
<pre><code class="java">
/**
 * p2p模型生产者
 * 
 */
public class Producer {
  private ConnectionFactory connFactory;
  private Connection conn;
  private Session session;
  private MessageProducer producer;

  Producer() {
    try {
      /* 创建链接工厂 */
      connFactory = new ActiveMQConnectionFactory("admin", "admin",
          "tcp://127.0.0.1:61616");
      /* 获取链接 */
      conn = connFactory.createConnection();
      conn.start();
      /* 获取Session */
      session = conn.createSession(true, Session.AUTO_ACKNOWLEDGE);
      /* 创建生产者 */
      producer = session.createProducer(session.createQueue("testQueue"));
      producer.setDeliveryMode(DeliveryMode.NON_PERSISTENT);
      System.out.println(sendMessage() ? "消息发送成功..." : "消息发送成功...");
    } catch (Exception e) {
      e.printStackTrace();
    } finally {
      if (null != conn) {
        try {
          conn.close();
        } catch (JMSException e) {
          e.printStackTrace();
        }
      }
    }
  }

  public boolean sendMessage() {
    boolean result = false;
    if (null != session && null != producer) {
      try {
        /* 发送消息 */
        producer.send(session.createTextMessage("test..."));
        session.commit();
        result = true;
      } catch (JMSException e) {
        try {
          session.rollback();
        } catch (JMSException e1) {
          e1.printStackTrace();
        }
      }
    }
    return result;
  }

  public static void main(String[] args) {
    new Producer();
  }
}

/**
 * Queue消费者
 *
 */
public class Consumer implements MessageListener {
  private ConnectionFactory connFactory;
  private Connection conn;
  private Session session;
  private MessageConsumer consumer;

  Consumer() {
    try {
      connFactory = new ActiveMQConnectionFactory("admin", "admin",
          "tcp://127.0.0.1:61616");
      conn = connFactory.createConnection();
      conn.start();
      session = conn.createSession(false, Session.AUTO_ACKNOWLEDGE);
      consumer = session.createConsumer(session.createQueue("testQueue"));
      consumer.setMessageListener(this);
    } catch (Exception e) {
      e.printStackTrace();
    }
  }

  public static void main(String[] args) {
    new Consumer();
  }

  @Override
  public void onMessage(Message arg0) {
    TextMessage msg = (TextMessage) arg0;
    try {
      System.out.println("收到消息->" + msg.getText());
    } catch (JMSException e) {
      e.printStackTrace();
    }
  }
}

</code></pre>
<blockquote>
<p style="text-indent:2em;">上面使用Queue实现了基于P2P的消息传递模型，而如果希望使用Topic实现pub/sub模型，只需要将生产者/消费者的代码片段：</p>
</blockquote>
<pre><code class="java">
session.createQueue("testQueue");
</code></pre>
<pre><code class="java">
session.createTopic("testTopic");
</code></pre>


                </section>
            </div>

 

        </div>
</div>
        <script>

            jQuery(document).ready(function($) {

                App.mapKeySupport();

                App.initNProgress();

                App.initDuoshuo();

                App.initTheater();
            });

        </script>

    </body>

    <div id="particles">
    <canvas class="pg-canvas"></canvas>
</div>
<script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?93757bc26a1b57b9c6a7771db256d254";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();

    $(function(){

        var $body = $("body");

        $("#particles").css({
                "width":$body.width(), 
                "height":$body.height()
            }).particleground({
                lineColor: '#e0e0e0',
                dotColor: '#EFEFEF',
                lineColor: '#EFEFEF',   
                minSpeedX :0.5,
                maxSpeedX :1,
                minSpeedY : 0.5,
                maxSpeedY :1
            });
    });
</script>
<footer>
  <span class="muted">© kbasha. All Rights Reserved.</span>
  <br>
  <br>
  <!--img src="/images/scribble2.png" alt="scribble" /-->
</footer>


</html>
